<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instruments - ASVAB Project</title>
  <link rel="stylesheet" href="/styles.css">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div class="p-8">
    <h1 class="text-2xl font-bold mb-4">Instruments</h1>
    <div id="loading">Loading instruments data...</div>
    <div id="error" class="hidden">
      <p class="text-red-500">Error loading instruments</p>
      <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded">
        <h2 class="text-lg font-semibold mb-2">Troubleshooting</h2>
        <ul class="list-disc pl-5">
          <li>Check that your Supabase environment variables are set correctly</li>
          <li>Verify that the 'instruments' table exists in your Supabase database</li>
          <li>Ensure you have permission to access this table</li>
        </ul>
      </div>
    </div>
    <div id="success" class="hidden">
      <div class="mb-4">
        <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm" id="count-badge">
          Successfully loaded instruments
        </span>
      </div>
      <pre class="bg-gray-100 p-4 rounded overflow-auto max-h-[500px]" id="data"></pre>
    </div>
  </div>

  <script>
    // Client-side only script that fetches instruments data
    document.addEventListener('DOMContentLoaded', async function() {
      const loadingEl = document.getElementById('loading');
      const errorEl = document.getElementById('error');
      const successEl = document.getElementById('success');
      const dataEl = document.getElementById('data');
      const countBadgeEl = document.getElementById('count-badge');

      try {
        // Fetch instruments data from our API
        const response = await fetch('/api/instruments-bypass', {
          method: 'GET',
          headers: {
            'Cache-Control': 'no-store',
            'Pragma': 'no-cache',
          },
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to fetch instruments');
        }
        
        const data = await response.json();
        
        // Display the data
        loadingEl.classList.add('hidden');
        successEl.classList.remove('hidden');
        
        const count = data.instruments ? data.instruments.length : 0;
        countBadgeEl.textContent = `Successfully loaded ${count} instruments`;
        
        dataEl.textContent = JSON.stringify(data.instruments, null, 2);
      } catch (err) {
        // Show error message
        loadingEl.classList.add('hidden');
        errorEl.classList.remove('hidden');
        
        const errorMessage = document.createElement('p');
        errorMessage.textContent = err.message || 'An error occurred';
        errorMessage.classList.add('text-red-500', 'font-bold');
        errorEl.prepend(errorMessage);
        
        console.error('Error fetching instruments:', err);
      }
    });
  </script>
</body>
</html> 
